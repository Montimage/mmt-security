<beginning>
<embedded_functions><![CDATA[
//each function name should be prefixed by em_

#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <inttypes.h>
#include "types_defs.h"

static inline int em_check_session(const void *ip_src, const void *ip_dst, const void *ip_src1, const void *ip_dst1){
  if((ip_src == NULL) || (ip_dst == NULL) || (ip_src1 == NULL) || (ip_dst1 == NULL)){
    return 2;
  }
  if (((ip_src = ip_src1) && (ip_dst = ip_dst1)) || ((ip_src = ip_dst1) && (ip_dst = ip_src1))){
	  //printf("In the same session\n");
	  return 1;
  }
  return 0;
}

static inline int em_check_http_response( const void *response){
   return response == NULL;
}

]]></embedded_functions>

<!-- Property 29, 30: HTTP version 0.9 detection-->

<property value="THEN" delay_units="ms" delay_min="0+" delay_max="500" property_id="29" type_property="EVASION" 
    description="HTTP response with no header (type 1)">
   <operator value="THEN" delay_units="ms" delay_min="0+" delay_max="250">
   <event value="COMPUTE" event_id="1" 
           description="Context: Here it is a HTTP GET packet"
           boolean_expression="((http.method == http.method)&amp;&amp;(tcp.packet_count != 0))"/>
   <event value="COMPUTE" event_id="2" 
		   description="Context: TCP ACK after HTTP GET"
           boolean_expression="((#em_check_session(ip.src, ip.dst, ip.src.1, ip.dst.1) == 1)&amp;&amp;((http.packet_count == http.packet_count.1)&amp;&amp;(tcp.packet_count != 0)))"/>
   </operator>
   <event value="COMPUTE" event_id="3" 
           description="Trigger: HTTP response contains no header"
		   boolean_expression="((ip.src == ip.dst.1)&amp;&amp;((ip.dst == ip.src.1)&amp;&amp;((http.packet_count == (http.packet_count.1 +1))&amp;&amp;((tcp.packet_count == (tcp.packet_count.2+1))&amp;&amp;(#em_check_http_response(http.response)==1)))))"/>
</property>

<property value="THEN" delay_units="ms" delay_min="0+" delay_max="500" property_id="30" type_property="EVASION" 
    description="HTTP response with no header right after the GET (type 2)"
    >
   <event value="COMPUTE" event_id="1" 
           description="Context: Here it is a HTTP GET packet"
           boolean_expression="((http.method == http.method)&amp;&amp;((ip.src != ip.dst)&amp;&amp;((http.packet_count != 0)&amp;&amp;(tcp.packet_count != 0))))"/>
   <event value="COMPUTE" event_id="2" 
           description="Trigger: HTTP response (and also TCP ACK) contains no HTTP header"
		   boolean_expression="((ip.src == ip.dst.1)&amp;&amp;((ip.dst == ip.src.1)&amp;&amp;((http.packet_count == (http.packet_count.1 +1))&amp;&amp;((tcp.packet_count == (tcp.packet_count.1+1))&amp;&amp;(#em_check_http_response(http.response)==1)))))"/>
</property>
</beginning>