<?xml version="1.0" encoding="UTF-8"?>
<project name="Rsync On Save" basedir="." default="rsync">
    <description>Builder for eclipse to rsync on save for OSX.</description>

    <!-- local source directory for rsync (read from this directory) -->
    <property name="rsync.source.dir" value="${basedir}"/> 

    <!-- remote rsync host -->
    <property name="rsync.destination.host" value="localhost"/>

    <!-- remote rsync directory (write to this directory) -->
    <property name="rsync.destination.dir" value="/home/mmt/"/>

    <!-- filepath to the ssh key-->
    <property name="rsync.ssh.key" value="/Users/nhnghia/.ssh/id_rsa"/>

    <!-- ssh user to login to remote -->
    <property name="rsync.ssh.user" value="mmt"/>

	
    <target name="rsync">
        <echo message="Rsync source:"/>
        <echo message="${rsync.source.dir}"/>
        <echo message="Rsync destination:"/>
        <echo message="${rsync.ssh.user}@${rsync.destination.host}:${rsync.destination.dir}"/>
        <exec dir="." executable="rsync">
            <arg value="-arv"/>
        	
            <!-- exclude all hidden files and directories -->
            <arg line="--exclude='.git*'"/>
        	<arg line="--exclude='*.deb'"/>
        	<arg line="--exclude='.*project'"/>
        	<arg line="--exclude='.externalToolBuilders'"/>
            <!-- exclude build.xml and rsync.xml -->
            <arg line="--exclude='build.xml'"/>
            <arg line="--exclude='rsync.xml'"/>

            <arg line="-e &quot;ssh -i ${rsync.ssh.key} -p 2222 &quot;"/>
        	
            <!-- local directory that is the source for the rsync -->
            <arg value="${rsync.source.dir}"/>

            <!-- remote host and directory destination for rsync -->
            <arg value="${rsync.ssh.user}@${rsync.destination.host}:${rsync.destination.dir}"/>
        </exec>
    	
        <echo message="BUILD"/>
        <exec dir="." executable="ssh">
            <arg value="-p 2222"/>
            <arg value="${rsync.ssh.user}@${rsync.destination.host}"/>
            <arg value="cd ${rsync.destination.dir}/mmt-security; make test.sec; valgrind --leak-check=yes ./security"/>
        </exec>
    </target>
    
</project>