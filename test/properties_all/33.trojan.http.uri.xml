<beginning>
<embedded_functions><![CDATA[

#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <inttypes.h>
#include "types_defs.h"
#include <sys/time.h>
#include "hash_table_str.h"

static inline int em_check_trojan_uri(const char * uri){
   	//printf("Enter the em\n");
   	int handle = 0;
   	//printf("http.uri: %s\n", uri);
	if(search_hash_str(Str2DataItem(uri)->key) != NULL) handle = 1;  
	//if(search_hash_str(15458465885129824347U) != NULL) handle = 1;   //for testing when we have not had attack traffic yet
  	return handle;
  }
]]></embedded_functions>

<!-- Property 33: TROJAN detection based on the hash table of 1703 blacklisted http_uri
(Ref: Suricata rules emerging-trojan.rules). 
NOTE: MMT_Security must run with -b option  -->

<property value="THEN" delay_units="ms" delay_min="0" delay_max="0" property_id="33" type_property="ATTACK" 
    description="Trojan detection">
    <event value="COMPUTE" event_id="1" 
           description="HTTP URI"
           boolean_expression="(#em_check_trojan_uri(http.uri) == 1)"/>
    <event value="COMPUTE" event_id="2" 
           description="HTTP GET"
           boolean_expression="(http.method == 'GET')"/> 
</property>
</beginning>